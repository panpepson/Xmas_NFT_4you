<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>mint_Xmas_NFT_4you</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="https://trochymiak.net/i/pep-32.png" type="image/x-icon">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <style>
body {
    font-family: 'Share Tech', sans-serif;
    font-size: 17px;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
    width: 100vw;
    height: 100vh;
    text-shadow: 8px 8px 10px #0000008c;
    background-color: #343a40;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%239C92AC' fill-opacity='0.25' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.98-7.5V0h-2v6.35L0 12.69v2.3zm0 18.5L12.98 41v8h-2v-6.85L0 35.81v-2.3zM15 0v7.5L27.99 15H28v-2.31h-.01L17 6.35V0h-2zm0 49v-8l12.99-7.5H28v2.31h-.01L17 42.15V49h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"), linear-gradient(to right top, #343a40, #2b2c31, #211f22, #151314, #000000);
}
 
h1 {
    margin: 30px;
}
.mint {
    width: auto;
}
#saveAndOpenButton {
            display: none; 
  }
.kasa{
     margin-left: 33%;
    }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<center>
<div class="container">
  <div class="row  justify-content-md-center">
    <div class="col-md-auto"> 
<h2>ğŸ… ğŸŒ²</h2
  <h3>Tu wymintujesz token</h3> <h2> Xmas_NFT_4you </h2><h4>na sieci <a href="https://www.gopulsechain.com/" target="_blank">PulsChaine</a>  jako Å›wiÄ…tecznÄ… kartkÄ™.</h4>    
    </div>
    <div class="col-md-auto">
    </div>
    <div class="col-md-auto">
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <div class="col-6">
     <div class="p-3"><div id="connectButton" class="btn btn-info rounded-pill">PoÅ‚Ä…cz swÃ³j portfel z sieciÄ… PulseChain</div></div>
    </div>
    <div class="col-6">
      <div class="p-3"><div id="balance"></div></div>
    </div>
  </div>
</div>
<div id="mintButtonContainer" class="d-grid gap-2"></div>
<br>
 <div id="tokenIdDisplay"></div>
 <div id="tokenUriDisplay"></div>
 <div id="buyInfo"></div>
 <button id="saveAndOpenButton">Zapisz token na dysku</button>
</center>

 <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  <script src="pabi.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      if (typeof window.ethereum !== 'undefined') {
        const ethereum = window.ethereum;
        try {
          await ethereum.enable();
          const web3 = new Web3(ethereum);

          await ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [
              {
                chainId: '0x171',
                chainName: 'PulseChain',
                rpcUrls: ['https://rpc.pulsechain.com'],
                nativeCurrency: {
                  name: 'PLS',
                  symbol: 'PLS',
                  decimals: 18,
                },
                blockExplorerUrls: ['https://otter.PulseChain.com'],
              },
            ],
         });

          const networkId = await web3.eth.net.getId();
          if (networkId === 369 ) {
          const contractAddress = '0x9DF4d4eC50132C53D5e4928F2688af26068fa096';
         const contract = new web3.eth.Contract(contractABI, contractAddress);
            const accounts = await web3.eth.getAccounts();
            const userAddress = accounts[0];
            document.getElementById('connectButton').innerHTML = `JesteÅ› zalogowany jako: <br><b>${userAddress}</b>`;
            const balance = await web3.eth.getBalance(userAddress);
            const formattedBalance = web3.utils.fromWei(balance, 'ether');
            document.getElementById('balance').innerHTML = `<p class="rounded-pill bg-success kasa">Saldo konta to : <br><b>${formattedBalance}</b> PLS</p>`;
            const numMinted = await contract.methods.numMinted().call();
            const userBalance = await contract.methods.balanceOf(userAddress).call();

            if (numMinted >= 12) {
              document.getElementById('buyInfo').innerHTML = '<b>Bida ğŸ¤” ziom, spÃ³ÅºniÅ‚eÅ› siÄ™ </b>teraz juÅ¼ tylko moÅ¼esz zdobyÄ‡ juÅ¼ wymintowane <b>Xmas_NFT_4you</b> na <a href="https://pulsemarket.app/collection/0x9DF4d4eC50132C53D5e4928F2688af26068fa096">https://pulsemarket.app</a>';
            } else if (userBalance > 12) {

            document.getElementById('buyInfo').innerHTML = `<br><br><h2> ğŸ§…  Masz juÅ¼ ğŸ§…  12 sztul <b>Xmas_NFT_4you</b> wiÄ™c daj szansÄ™ innym ğŸ«²ğŸ˜ğŸ«±</h2> <br>WiÄ™cej INFO dot kontraktu znajdziesz tu <a href="https://otter.pulsechain.com/address/address/${contractAddress}" target="_blank">${contractAddress}</a>`;
            } else {
              document.getElementById('mintButtonContainer').innerHTML = '<button id="mintButton" type="button" class="btn btn-primary bg-dark rounded-pill mint"><h1>ğŸ…Mintuj Xmas_NFT_4youğŸŒ²</h1></button>';
              document.getElementById('mintButton').addEventListener('click', async () => {
                try {
                  const result = await contract.methods.mint().send({ from: userAddress });
                  console.log('Transakcja udana:', result);

                  const tokenId = result.events.Transfer.returnValues.tokenId;
                  document.getElementById('tokenIdDisplay').innerHTML = `
<div><br><h2> OK udaÅ‚o siÄ™ ğŸ‘ğŸ¤  masz juÅ¼ token o numerze ${tokenId} ğŸ˜</h2><br> 
<h3>Oto <b>Instrukcje</b> jak dodaÄ‡ token do portfrla:</h3>
OtwÃ³rz np. MetaMaska w swojej przeglÄ…darce.<br>
Kliknij na ikonÄ™ MetaMaska ğŸ¦Š na pasku przegladarki.<br>
Wybierz zakÅ‚adkÄ™ <b>"NFTs"</b> i na dole .<br>
Kliknij <b>"+ Importuj NFT"</b><br><br>
WprowadÅº Adres kontraktu: <b>${contractAddress}</b><br>
WprowadÅº Token ID: <b>${tokenId}</b><br>
Kliknij "Dodaj".<br><br>
Albo odwiedÅº strone <a href="https://pulsemarket.app/collection/0x9DF4d4eC50132C53D5e4928F2688af26068fa096">https://pulsemarket.app</a> i zaloguj siÄ™ tam portfelem ktÃ³rym mintowaleÅ› token, token juÅ¼ tam powinien byÄ‡ ğŸ¤ ğŸ¤–</div>`;
          

    const tokenURI = await contract.methods.tokenURI(tokenId).call();
    document.getElementById('saveAndOpenButton').style.display = 'block'; 

var dataToDecode = tokenURI.replace("data:application/json;base64,", "");
var decodedBytes = atob(dataToDecode);
var jsonData = JSON.parse(decodedBytes);
var dataToDecode2 = jsonData.animation_url.replace("data:text/html;base64,", "");
var decodedHtml = atob(dataToDecode2);

   document.getElementById("saveAndOpenButton").addEventListener("click", function() {
            const animationCode = decodedHtml;
            const blob = new Blob([animationCode], { type: "text/html" });
            const downloadLink = document.createElement("a");
            downloadLink.href = URL.createObjectURL(blob);
            downloadLink.download = "Twoj_token_Xmas_NFT_4you.html";
            downloadLink.click();
        });
 
                 //document.getElementById('tokenUriDisplay').innerHTML = `<br><br>To jest tokenURI moÅ¼na to sobie zachowaÄ‡ na pamiÄ…tkÄ™, to zawiera fullToken w caÅ‚ej rodzielczoÅ›ci: <a href="${tokenURI}" target="_blank"> ${tokenURI}</a>`;
 document.getElementById('mintButton').style.display = 'none'; 


                   } catch (error) {
                  console.error('BÅ‚Ä…d podczas mintowania:', error);
                }
              });
            }
          }
        } catch (error) {
          console.error(error);
        }
      } else {
        console.log('MetaMask nie jest dostÄ™pny w przeglÄ…darce.');
      }

    });

</script>
</body>
</html>

